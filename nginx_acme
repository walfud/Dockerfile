FROM nginx:1.19
LABEL maintainer="hi@walfud.com"

ENV ID=
ENV SK=
ENV HOST=walfud.com

# Install Utils
RUN apt-get update
RUN apt-get install -qy curl cron

# acme
RUN curl https://get.acme.sh | sh

# Issue Certificate
WORKDIR /
ENTRYPOINT export Ali_Key=$ID; \
           export Ali_Secret=$SK; \
           ~/.acme.sh/acme.sh --issue --dns dns_ali -d "*.$HOST"; \
           mkdir -p "/cert/*.${HOST}"; \
           sleep 9999
EXPOSE 80 443